<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whalegoods.mapper.GoodsAdsMiddleMapper">
  <resultMap id="BaseResultMap" type="com.whalegoods.entity.response.ResGoodsAdsMiddle">
    <result column="goods_code" jdbcType="VARCHAR" property="goodsCode" />
    <result column="pic_url" jdbcType="VARCHAR" property="picUrl" />
    <result column="sale_price" jdbcType="VARCHAR" property="salePrice" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="stock" jdbcType="INTEGER" property="stock" />
    <result column="market_price" jdbcType="DECIMAL" property="marketPrice" />
  </resultMap>
  
    <!-- 查询促销商品列表 -->
    <select id="selectListByObjCdt" parameterType="com.whalegoods.entity.GoodsAdsMiddle" resultMap="BaseResultMap">
    SELECT 
    c.goods_code,
    c.pic_url,
    c.market_price,
    b.sale_price,
    b.stock,
    a.type
    FROM goods_ads_middle a INNER JOIN  device_road b ON a.device_road_id=b.id 
    INNER JOIN goods_sku c ON b.goods_sku_id=c.id
    INNER JOIN device d ON  d.id=b.device_id
    <where>
     <if test="deviceIdJp !=null and deviceIdJp !=''"> AND device_id_jp=#{deviceIdJp}</if>
     <if test="deviceIdSupp !=null and deviceIdSupp !=''"> AND device_id_supp=#{deviceIdSupp}</if>
     <if test="type !=null and type !=''"> AND type=#{type}</if>
    </where>
    ORDER BY a.type
  </select>
  
  <!-- 查询促销商品列表 -->
    <select id="selectAdsMiddleList" parameterType="java.util.Map" resultMap="BaseResultMap">
    SELECT 
    c.goods_code,
    c.pic_url,
    c.market_price,
    b.sale_price,
    b.stock,
    a.type
    FROM goods_ads_middle a INNER JOIN  device_road b ON a.device_road_id=b.id 
    INNER JOIN goods_sku c ON b.goods_sku_id=c.id
    INNER JOIN device d ON  d.id=b.device_id
    <where>
     <if test="deviceIdJp !=null and deviceIdJp !=''"> AND device_id_jp=#{deviceIdJp}</if>
     <if test="deviceIdSupp !=null and deviceIdSupp !=''"> AND device_id_supp=#{deviceIdSupp}</if>
     <if test="type !=null and type !=''"> AND type=#{type}</if>
    </where>
    ORDER BY a.type
  </select>
  
  <!-- 插入新记录 -->
    <insert id="insert" parameterType="com.whalegoods.entity.GoodsAdsMiddle">
    INSERT INTO goods_ads_middle (
    id,
    device_road_id, 
    type, 
    create_by,
    create_date,
    update_by,
    update_date)
    VALUES (
    #{id},
    #{deviceRoadId}, 
    #{type}, 
    #{createBy}, 
    now(),
    #{updateBy},
    now()
    )
  </insert>

</mapper>